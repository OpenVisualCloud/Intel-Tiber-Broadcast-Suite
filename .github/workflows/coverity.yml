name: Coverity scan

on:
  push:
  workflow_call:
  workflow_dispatch:

env:
  BUILD_TYPE: "Release"
  DOCKER_IMAGE_BASE: "ghcr.io/openvisualcloud/intel-tiber-broadcast-suite"
  DOCKER_IMAGE_NAME: "tiber-broadcast-suite-build"
  DOCKER_IMAGE_TAG: "${{ github.sha }}"
  DEBIAN_FRONTEND: "noninteractive"

jobs:
  build-stage-build:
    name: 'build BCS build stage'
    runs-on: ['self-hosted', 'Linux', 'cov']
    steps:
      - name: "Validation: Build/Push Dokcerfile"
        uses: docker/build-push-action@ca052bb54ab0790a636c9b5f226502c73d547a25 # v5.4.0
        with:
         file: Dockerfile
         push: false
         load: true
         target: build-stage
         tags: "${{ env.DOCKER_IMAGE_BASE }}/${{ env.DOCKER_IMAGE_NAME }}:${{ env.DOCKER_IMAGE_TAG }}"
         platforms: "linux/amd64"